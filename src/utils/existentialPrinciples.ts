/**
 * Existential principles and concepts based on Viktor Frankl's Logotherapy
 * and broader existential psychology frameworks
 */

// Core concepts of existential psychology and logotherapy
export const existentialPrinciples = {
  // Freedom, responsibility, and meaning
  coreIdeas: {
    description: "Existential psychology emphasizes that humans have freedom to choose their response to any situation, bear responsibility for their choices, and can find meaning even in suffering.",
    keyIdeas: [
      "Freedom of response - While circumstances may be beyond our control, we always retain freedom to choose our attitude toward them.",
      "Responsibility - With freedom comes responsibility for our choices and their consequences.",
      "Will to meaning - Humans have a primary motivational drive to find meaning in life.",
      "Meaning in suffering - Even in unavoidable suffering, meaning can be found through one's attitude toward suffering.",
      "Self-transcendence - Meaning comes from transcending self-focus toward values, causes, or others beyond oneself."
    ]
  },

  // The Three Wills concept from logotherapy
  threeWills: {
    description: "Frankl identified three fundamental motivational drives or 'wills' that are present in human experience:",
    wills: [
      {
        name: "Will to Pleasure",
        description: "The drive for enjoyment, satisfaction, and avoidance of pain. Dominant in Freudian psychology.",
        limitations: "When pursued directly as life's primary aim, often results in paradoxical loss of pleasure and satisfaction."
      },
      {
        name: "Will to Power",
        description: "The drive for achievement, influence, control, and overcoming challenges. Emphasized in Adlerian psychology.",
        limitations: "When pursued as an end in itself, can lead to emptiness despite outward success."
      },
      {
        name: "Will to Meaning",
        description: "The primary human motivation - the drive to find purpose, significance, and coherence in one's existence.",
        significance: "Not just another 'will' alongside the others, but a more fundamental motivational force that, when fulfilled, allows healthy expression of the other drives."
      }
    ],
    implications: "Unlike pleasure and power, meaning cannot be directly pursued but emerges as a by-product of living purposefully and serving something beyond oneself. When meaning is established, pleasure and power find their proper place in a person's life."
  },

  // Tri-dimensional ontology from logotherapy
  dimensions: {
    description: "Humans exist in three overlapping dimensions: physical, psychological, and spiritual/noological (meaning-oriented).",
    dimensionDetails: [
      {
        name: "Physical/Somatic",
        aspects: ["The body", "Biological processes", "Physiological needs", "Sensory experiences"],
        examples: "Hunger, pain, pleasure, basic drives"
      },
      {
        name: "Psychological",
        aspects: ["Emotions", "Thoughts", "Learned behaviors", "Personality", "Social conditioning"],
        examples: "Feelings, memories, habits, defense mechanisms"
      },
      {
        name: "Spiritual/Noological",
        aspects: ["Meaning", "Values", "Purpose", "Conscience", "Self-transcendence", "Responsibility", "Free will"],
        examples: "Moral choices, creative expression, love, religious experience"
      }
    ],
    implications: [
      "The spiritual dimension is what distinguishes humans and enables meaning-seeking.",
      "When physical or psychological dimensions are compromised, the spiritual dimension can still function.",
      "Healing can occur through accessing the spiritual dimension even when other dimensions are suffering.",
      "True human fulfillment requires engagement at all three levels, especially the spiritual."
    ]
  },

  // Ways of finding meaning according to logotherapy
  pathsToMeaning: {
    description: "According to Frankl, meaning can be discovered through three main avenues:",
    paths: [
      {
        name: "Creative values",
        description: "Finding meaning through what we give to the world - work, creativity, achievements.",
        examples: "Creating art, building a business, writing, teaching, inventing, parenting"
      },
      {
        name: "Experiential values", 
        description: "Finding meaning through what we receive from the world - experiencing goodness, beauty, truth, nature, culture, or love.",
        examples: "Appreciating art, nature, loving relationships, profound moments"
      },
      {
        name: "Attitudinal values",
        description: "Finding meaning through the stance we take toward unavoidable suffering - courage, dignity, and growth in the face of adversity.",
        examples: "Maintaining dignity despite illness, finding purpose in hardship, transforming tragedy"
      }
    ],
    key_insight: "Meaning is always available, even when creative and experiential paths seem blocked. The attitudinal path to meaning remains accessible in even the most limiting circumstances."
  },

  // Self-transcendence concept
  selfTranscendence: {
    description: "A core concept in logotherapy - the human capacity to reach beyond oneself toward something or someone else.",
    key_aspects: [
      "Moving beyond self-focus toward causes, values, people, or purposes greater than oneself",
      "The paradox that fulfillment comes not from direct pursuit of happiness, but as a byproduct of serving something beyond oneself",
      "Not necessarily religious or spiritual in conventional sense, but involving connection to meaning outside one's own needs"
    ],
    contrast: "Modern focus on self-improvement, self-actualization, and self-fulfillment can paradoxically increase self-preoccupation and emptiness",
    application: "Helping clients identify opportunities for self-transcendence through service, love, causes, or creative work can alleviate existential vacuum"
  },

  // Existential vacuum and noogenic neurosis
  meaninglessness: {
    description: "The absence of meaning can lead to existential vacuum or frustration.",
    manifestations: [
      "Boredom and apathy ('just going through the motions')",
      "Conformism (doing what others do without question)",
      "Totalitarianism (doing what others tell you to do)",
      "The 'mass neurotic triad': aggression, depression, and addiction as attempts to fill the emptiness"
    ],
    existentialVacuum: {
      description: "A state of inner emptiness characterized by a sense that life lacks meaning or purpose",
      symptoms: [
        "Pervasive boredom and apathy",
        "Sunday neurosis - empty time leads to awareness of lack of meaning",
        "Existential frustration - conscious awareness of meaninglessness",
        "Provisional living - waiting for 'real life' to begin rather than engaging fully now"
      ],
      compensations: [
        "Hyperreflection - obsessive self-focus that paradoxically increases problems",
        "Hyperintention - forcing outcomes that resist direct pursuit",
        "Conformity - uncritical adoption of others' values to avoid confronting emptiness",
        "Fanaticism - absolute adherence to narrow causes to provide sense of certainty",
        "Will to power - pursuit of control, status or achievement as substitute for meaning",
        "Will to pleasure - hedonism, substance use, and distraction as temporary escape"
      ]
    },
    noogenicNeurosis: "Distress arising specifically from existential frustration or crisis of meaning that cannot be addressed by conventional psychological approaches alone."
  },

  // NEW: Expanded section on grief and existential loneliness
  griefAndLoneliness: {
    description: "Grief, particularly the loss of a spouse or intimate partner, creates a unique form of existential loneliness that differs from other forms of social isolation.",
    keyAspects: [
      {
        name: "Existential loneliness in grief",
        description: "A profound form of isolation that persists regardless of social connection, stemming from the loss of someone who deeply knew and witnessed one's life.",
        aspects: [
          "The loss of being deeply known by another person",
          "The absence of a witness to one's life history and journey",
          "The irreplaceability of intimacy built over decades",
          "The loss of seeing oneself reflected through another's knowing gaze",
          "The unique loneliness that cannot be addressed by friendship or community alone"
        ]
      },
      {
        name: "Spousal loss",
        description: "The death of a spouse represents a unique form of loss with distinct existential implications.",
        aspects: [
          "Loss of a shared history that often spans decades",
          "Disruption of identity formed within and reflected by the relationship",
          "Loss of daily intimacy built through proximity and time",
          "Absence of the person who witnessed one's life most completely",
          "Loss of future plans and shared meaning structures"
        ]
      },
      {
        name: "Irreplaceability",
        description: "The recognition that certain relationships cannot be substituted or recreated, which intensifies grief but also honors the singular nature of the bond.",
        aspects: [
          "The uniqueness of each relationship makes true replacement impossible",
          "The time-depth of long relationships creates layers of meaning that cannot be quickly rebuilt",
          "The shared context and history are irretrievable once lost",
          "The particular way of being known cannot be replicated even in new loving relationships"
        ]
      }
    ],
    existentialResponses: [
      "Acknowledging the unique nature of the loss without attempting to minimize it",
      "Validating the profound loneliness that persists despite other social connections",
      "Recognizing that this type of loss challenges one's very sense of being and identity",
      "Exploring how meaning can still be found while honoring the irreplaceability of what was lost",
      "Approaching the grief not as a problem to solve but as an experience to be witnessed"
    ]
  },

  // Practical applications in supportive conversations
  application: {
    description: "Existential principles can be applied in supportive dialogue through specific approaches:",
    approaches: [
      "Affirming freedom and responsibility - Helping people recognize choices they still have",
      "Perspective shifting - Helping reframe situations to reveal potential meaning",
      "Values clarification - Exploring what matters most to the person",
      "Meaning-centered questions - Questions that invite reflection on purpose and values",
      "Socratic dialogue - Questions that help people discover their own wisdom and insights",
      "Self-distancing - Helping gain perspective through humor or by stepping back from immediate concerns"
    ]
  },
  
  // Logotherapeutic techniques
  techniques: {
    description: "Specific techniques developed in logotherapy to help individuals discover meaning:",
    methods: [
      {
        name: "Paradoxical intention",
        description: "A technique where the client is encouraged to intend or wish for the very thing feared, often with humor, to break the cycle of anticipatory anxiety.",
        implementation: "The client deliberately exaggerates or wishes for the feared symptom, introducing humor and distance from the fear.",
        examples: [
          "For insomnia: trying to stay awake as long as possible rather than trying to fall asleep",
          "For public speaking anxiety: wishing to show everyone how nervous you can be",
          "For trembling: trying to tremble as much as possible"
        ]
      },
      {
        name: "Dereflection",
        description: "Redirecting attention away from excessive self-focus or symptom monitoring toward meaningful external values and purposes.",
        implementation: "Shifting focus from self-observation to engagement with meaningful activities, relationships, or values.",
        examples: [
          "For sexual dysfunction: focusing on partner rather than monitoring performance",
          "For obsessive symptom checking: engaging in meaningful service to others",
          "For anxiety: focusing attention outward on valued activities rather than internal states"
        ]
      },
      {
        name: "Socratic dialogue",
        description: "Using questions to help clients discover their own meanings, values, and wisdom rather than providing direct advice.",
        implementation: "Strategic questioning that leads clients to discover their own insights about meaning and values.",
        examples: [
          "What has given your life meaning in the past?",
          "What would you want to be remembered for?",
          "When do you feel most alive or engaged?",
          "What do you value most, even in difficult times?"
        ]
      },
      {
        name: "Attitude modification",
        description: "Helping clients shift attitudes toward situations that cannot be changed, finding freedom in their response to circumstances.",
        implementation: "Working with clients to find meaning in difficult situations through their chosen response.",
        examples: [
          "Finding purpose in caregiving during a loved one's illness",
          "Discovering meaning through maintaining dignity amid suffering",
          "Creating legacy or helping others despite terminal illness"
        ]
      },
      {
        name: "Mountain Range Exercise",
        description: "A values clarification exercise where individuals identify important people in their lives and what values they share with them.",
        implementation: "Client draws mountains with significant people placed on peaks, then explores shared values and qualities."
      },
      {
        name: "Movies Exercise",
        description: "Creating a mental 'movie' of one's life (past to present, and present to future) to clarify personal meaning and direction.",
        implementation: "Client creates two mental films - one of past to present, another from present to future - exploring themes, characters, and meaning."
      },
      {
        name: "Logo-analysis",
        description: "A structured method to help people discover their personal meanings and translate them into concrete goals and actions.",
        implementation: "Systematic process involving values identification, writing exercises, and goal setting."
      }
    ]
  },
  
  // Relationship to positive psychology and other therapies
  relationships: {
    description: "Logotherapy connects with many other therapeutic approaches:",
    connections: [
      "Precursor to aspects of cognitive therapy, particularly in attitude modification",
      "Complementary to humanistic approaches through focus on human potential",
      "Aligned with positive psychology through emphasis on meaning, resilience, and growth",
      "Compatible with spirituality-focused approaches (in the broad sense of meaning and purpose)"
    ]
  }
};

// Signs that may indicate someone is experiencing existential concerns
export const existentialIndicators = {
  meaningQuestions: [
    "what's the point",
    "why bother",
    "no purpose",
    "meaningless",
    "doesn't matter",
    "what am i doing with my life",
    "what's it all for",
    "why am i here",
    "purpose in life",
    "reason for living",
    "empty",
    "just going through the motions",
    "nothing matters"
  ],
  
  valuesConcerns: [
    "values",
    "what matters",
    "important to me",
    "care about",
    "priorities",
    "what i stand for",
    "believe in",
    "lost sight of",
    "reconnect with",
    "don't know what I value anymore",
    "not sure what's important"
  ],
  
  freedomAnxiety: [
    "too many choices",
    "don't know what to do",
    "overwhelmed by options",
    "afraid of making the wrong choice",
    "what if i regret",
    "responsibility",
    "weight of decisions",
    "stuck with my choices",
    "no way out"
  ],
  
  isolationConcerns: [
    "alone in this",
    "no one understands",
    "fundamentally alone",
    "disconnected",
    "separated from others",
    "gap between",
    "no real connection",
    "isolated",
    "no one gets it",
    // New additions for spousal loss
    "no one will ever know me like",
    "knew me completely",
    "knew everything about me",
    "shared everything with",
    "only person who really knew me"
  ],
  
  mortalityConcerns: [
    "limited time",
    "life is short",
    "getting older",
    "before i die",
    "legacy",
    "mark on the world",
    "remember me",
    "death",
    "finitude",
    "impermanence",
    "running out of time"
  ],
  
  sufferingQuestions: [
    "why is this happening",
    "can't see any purpose in",
    "senseless suffering",
    "enduring this",
    "meaning in pain",
    "learn from this",
    "grow through this",
    "unfair",
    "why me",
    "can't bear this"
  ],
  
  existentialVacuum: [
    "feel empty",
    "just existing",
    "going through motions",
    "bored with everything",
    "nothing excites me",
    "nothing to look forward to",
    "no direction",
    "drifting",
    "hollow"
  ],
  
  // Expanded indicators for spousal loss and grief
  spousalLossConcerns: [
    "lost my spouse",
    "lost my husband",
    "lost my wife",
    "lost my partner",
    "widow",
    "widower",
    "after they died",
    "since they passed",
    "years together",
    "decades together",
    "marriage ended",
    "died before",
    "long marriage",
    "irreplaceable relationship"
  ],
  
  existentialLoneliness: [
    "existential loneliness",
    "alone in a different way", 
    "lonely in a crowd",
    "friends don't help",
    "different kind of lonely",
    "nobody will ever know me",
    "irreplaceable",
    "can't be recreated",
    "not the same",
    "unique relationship",
    "nobody knows me anymore",
    "lost part of myself"
  ],
  
  // Additional indicators based on lecture materials
  provisionalLiving: [
    "waiting for life to begin",
    "when this is over then i'll",
    "someday i'll actually",
    "not really living now",
    "just preparing for",
    "temporary situation",
    "can't start living until"
  ],
  
  hyperreflection: [
    "constantly analyzing myself",
    "overthinking everything",
    "too self-aware",
    "can't stop thinking about",
    "obsessing over",
    "monitoring every reaction",
    "hyper-focused on myself"
  ]
};

// Generate existential responses to different types of concerns
export const generateExistentialResponse = (userInput: string): string | null => {
  const lowerInput = userInput.toLowerCase();
  
  // Check for meaning-related concerns
  const hasMeaningConcerns = existentialIndicators.meaningQuestions.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasMeaningConcerns) {
    const meaningResponses = [
      "I notice you're reflecting on questions of meaning and purpose. These are such important human questions. What kinds of things have felt meaningful to you in the past?",
      
      "Questions about meaning are at the heart of our human experience. Viktor Frankl suggested we can find meaning in three ways: through what we create or give, through what we experience and receive from the world, and through how we face unavoidable difficulties. Which of these resonates with you right now?",
      
      "It takes courage to face questions about meaning. In my understanding, meaning isn't something we simply find but something we actively create through our choices and values. What values feel most important to you, even in difficult times?",
      
      "Those questions about purpose are so deeply human. Many people find that meaning comes not from having all the answers, but from living according to what truly matters to them. What matters most to you, even when life feels challenging?",
      
      "The search for meaning can be both challenging and revealing. Sometimes when we feel a lack of meaning, it's pointing us toward what we truly value. What aspects of your life have felt meaningful, even if in small ways?",
      
      "Viktor Frankl suggested that our 'will to meaning' is our primary motivation, more fundamental than pleasure or power. When have you felt most aligned with your sense of purpose or meaning?"
    ];
    
    return meaningResponses[Math.floor(Math.random() * meaningResponses.length)];
  }
  
  // Check for existential vacuum indicators
  const hasExistentialVacuum = existentialIndicators.existentialVacuum.some(phrase => 
    lowerInput.includes(phrase));
    
  if (hasExistentialVacuum) {
    const vacuumResponses = [
      "That sense of emptiness you're describing is what Viktor Frankl called an 'existential vacuum' - a feeling that life lacks meaning or purpose. Sometimes this feeling actually invites us to discover what truly matters to us. What would a meaningful life look like for you?",
      
      "Feeling like you're just going through the motions can be really difficult. In logotherapy, this might be seen as an opportunity to reconnect with what gives your life meaning. What activities or relationships have helped you feel most alive or engaged in the past?",
      
      "That sense of emptiness is something many people experience at different points in life. Rather than seeing it as purely negative, it might be signaling an opportunity to explore what would bring more meaning to your life. What do you feel drawn toward, even if it seems distant right now?",
      
      "The feeling of 'just existing' rather than truly living is something many people face. Viktor Frankl might suggest this feeling can motivate us to discover or create meaning. What small thing might bring a sense of purpose to your day today?",
      
      "That hollowness you're describing is a deeply human experience. Sometimes it emerges when we're disconnected from our values or what matters to us. If you could live aligned with what's truly important to you, what might that look like?",
      
      "What you're describing sounds like what Frankl called the 'existential vacuum' - when we feel our lives lack meaningful purpose. This is often a significant moment that can lead us to discover what truly matters. What activities or connections have made you feel most alive in the past?"
    ];
    
    return vacuumResponses[Math.floor(Math.random() * vacuumResponses.length)];
  }
  
  // Check for values-related concerns
  const hasValuesConcerns = existentialIndicators.valuesConcerns.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasValuesConcerns) {
    const valuesResponses = [
      "Values are like a compass that can guide us through difficult times. When you think about what truly matters to you, what comes to mind, even if it feels distant right now?",
      
      "Reconnecting with our values can be clarifying when life feels uncertain. If you were living fully aligned with what matters most to you, what might that look like, even in small ways?",
      
      "I appreciate you reflecting on what's important to you. Sometimes our challenges can actually help us clarify our values. Has this difficulty highlighted anything that you realize matters deeply to you?",
      
      "Our values can sometimes be revealed in what we find ourselves missing or longing for. What qualities or experiences do you find yourself drawn to, even if they're not fully present in your life right now?",
      
      "When we feel disconnected from what matters to us, that awareness itself can be the first step toward realignment. What small step might help you express or connect with something you value today?",
      
      "In logotherapy, clarifying our values is essential to finding meaning. Sometimes it helps to think about what you'd want to be remembered for, or what you'd regret not doing. What comes to mind when you consider those questions?"
    ];
    
    return valuesResponses[Math.floor(Math.random() * valuesResponses.length)];
  }
  
  // Check for freedom/choice concerns
  const hasFreedomConcerns = existentialIndicators.freedomAnxiety.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasFreedomConcerns) {
    const freedomResponses = [
      "Having many choices can sometimes feel as challenging as having none. When you face important decisions, what has helped you find clarity in the past?",
      
      "The weight of responsibility that comes with freedom can feel heavy at times. What values might help guide your choices in this situation?",
      
      "It takes courage to make choices when the outcomes aren't certain. What would making a choice that you could stand behind look like, regardless of how things turn out?",
      
      "We can't control everything that happens, but we always retain the freedom to choose our attitude toward our circumstances. What perspective might make this situation more manageable for you?",
      
      "Sometimes when we feel overwhelmed by choices, it helps to connect with what matters most to us. Which option feels most aligned with who you want to be and what you value?",
      
      "Viktor Frankl emphasized that our ultimate freedom lies in our ability to choose our response to any situation. What choice, even if it's just in attitude, do you still have in this situation?"
    ];
    
    return freedomResponses[Math.floor(Math.random() * freedomResponses.length)];
  }
  
  // Check for isolation concerns
  const hasIsolationConcerns = existentialIndicators.isolationConcerns.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasIsolationConcerns) {
    const isolationResponses = [
      "That feeling of fundamental aloneness is something many people experience. While each of us has unique experiences that others can't fully understand, what helps you feel most connected to others despite these differences?",
      
      "The gap between ourselves and others can sometimes feel vast. Yet in sharing our authentic experiences, as you're doing now, we can create bridges of understanding. What would feeling genuinely understood look like for you?",
      
      "Many philosophers have reflected on how each person's experience is ultimately their own. Yet meaningful connection remains possible. What kinds of connections have felt most genuine to you in the past?",
      
      "That sense of separation is something many grapple with. Sometimes, it's in acknowledging our separate experiences that we can paradoxically feel more connected through our shared humanity. What aspects of your experience do you think others might relate to?",
      
      "While we each journey through life in our own unique way, we can still walk alongside others. What qualities in relationships help you feel less alone in your experience?",
      
      "Existential thinkers recognize that while there's an ultimate aloneness to human experience, there's also the possibility of deep connection. When have you felt moments of genuine connection with others, even amid feelings of isolation?"
    ];
    
    return isolationResponses[Math.floor(Math.random() * isolationResponses.length)];
  }
  
  // Check for mortality concerns
  const hasMortalityConcerns = existentialIndicators.mortalityConcerns.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasMortalityConcerns) {
    const mortalityResponses = [
      "Awareness of life's finite nature can actually help clarify what matters most to us. How has thinking about the limited time we have influenced what you value?",
      
      "Many find that acknowledging life's temporal nature brings important questions into focus. What feels most worthy of your time and energy when you consider the preciousness of life?",
      
      "The recognition that our time is limited can be both challenging and clarifying. What would you like your days to reflect about what matters to you?",
      
      "Many meaningful lives have been shaped by the awareness that our time here is finite. How might this awareness guide your choices about what deserves your attention?",
      
      "Legacy can mean different things to different people - from relationships we nurture to work we create to values we embody. What aspects of your life feel most meaningful when you think about what endures?",
      
      "Viktor Frankl suggested that confronting our mortality can actually free us to live more fully and authentically. What would it mean for you to live more fully aligned with what truly matters?"
    ];
    
    return mortalityResponses[Math.floor(Math.random() * mortalityResponses.length)];
  }
  
  // Check for suffering-related concerns
  const hasSufferingConcerns = existentialIndicators.sufferingQuestions.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasSufferingConcerns) {
    const sufferingResponses = [
      "Viktor Frankl, who survived the concentration camps, suggested that meaning can be found even in unavoidable suffering - not in the suffering itself, but in how we face it. What strengths do you notice in yourself as you navigate this challenge?",
      
      "Some difficulties don't have clear meaning or purpose, and I wouldn't suggest that all suffering happens for a reason. But even in difficult circumstances, many people find they can still make meaningful choices about their response. What helps you maintain your sense of dignity through this?",
      
      "The question of why we suffer is one humans have grappled with throughout history. While I don't have answers about why specific hardships occur, I wonder what has helped sustain you through difficult times before?",
      
      "Even when circumstances are beyond our control, Viktor Frankl suggested we retain the freedom to choose our attitude toward those circumstances. What perspective helps you face this situation with the most strength?",
      
      "Finding meaning amid suffering doesn't make the suffering itself good or necessary, but it can help us bear it with more resilience. What values or sources of meaning help you navigate through challenging times?",
      
      "One of Frankl's key insights was that even when all else is taken away, we retain the freedom to choose our attitude toward our circumstances. What attitude feels most meaningful or helpful for you to hold in this difficult situation?"
    ];
    
    return sufferingResponses[Math.floor(Math.random() * sufferingResponses.length)];
  }
  
  // Check for provisional living indicators
  const hasProvisionalLiving = existentialIndicators.provisionalLiving.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasProvisionalLiving) {
    const provisionalResponses = [
      "It sounds like you're describing what Frankl might call 'provisional living' - putting life on hold until certain conditions are met. What small ways might you engage more fully with life right now, even amid the current circumstances?",
      
      "Many people find themselves waiting for the 'right time' to truly start living. Yet meaning can often be found in embracing our current reality, even with its limitations. What possibilities might be available to you right now?",
      
      "There's a common tendency to put life on hold until conditions seem perfect. Yet meaningful moments are often available in the present, despite challenges. What aspects of life could you engage with more fully today?",
      
      "The idea of waiting for 'real life' to begin is something many experience. Yet in logotherapy, we find that meaning emerges from engaging with life as it is now. What meaningful engagement might be possible, even in this waiting period?",
      
      "Sometimes we postpone living fully until certain conditions are met. Yet Frankl would suggest that meaning is available in every moment, even difficult ones. What matters to you that you could connect with right now, despite current limitations?"
    ];
    
    return provisionalResponses[Math.floor(Math.random() * provisionalResponses.length)];
  }
  
  // Check for hyperreflection indicators
  const hasHyperreflection = existentialIndicators.hyperreflection.some(phrase => 
    lowerInput.includes(phrase));
  
  if (hasHyperreflection) {
    const hyperreflectionResponses = [
      "What you're describing sounds like what Frankl called 'hyperreflection' - becoming so self-focused or analytical that it actually intensifies our struggles. Sometimes shifting our focus outward toward meaningful activities or relationships can help. What matters to you that could draw your attention outward?",
      
      "Becoming too self-focused or analytical can sometimes make our challenges feel bigger. In logotherapy, a technique called 'dereflection' involves shifting attention away from ourselves toward meaning outside ourselves. What meaningful activities help you forget yourself for a while?",
      
      "Sometimes we can get caught in cycles of overthinking that make problems worse. Frankl developed a technique called 'dereflection' specifically for this - redirecting focus from self-monitoring toward meaningful engagement. What activities help you feel engaged beyond self-analysis?",
      
      "That intense self-focus can sometimes amplify our struggles. Finding meaning often happens when we're focused on something or someone beyond ourselves. What people, activities, or purposes help you feel more connected beyond your own thoughts?",
      
      "Excessive self-monitoring can sometimes increase our difficulties. Logotherapy suggests that meaning and healing often come when we're engaged with something beyond ourselves. What meaningful activities help you forget yourself for a while?"
    ];
    
    return hyperreflectionResponses[Math.floor(Math.random() * hyperreflectionResponses.length)];
  }
  
  // New: Check for spousal loss and existential loneliness
  const hasSpousalLoss = existentialIndicators.spousalLossConcerns.some(phrase => 
    lowerInput.includes(phrase));
    
  const hasExistentialLoneliness = existentialIndicators.existentialLoneliness.some(phrase => 
    lowerInput.includes(phrase));
    
  if (hasSpousalLoss && (hasExistentialLoneliness || lowerInput.includes("loneliness"))) {
    const spousalLossResponses = [
      "The loneliness you're describing after losing your spouse speaks to what philosophers call 'existential loneliness' - that profound aloneness that can exist even when surrounded by others. It comes from losing someone who truly knew you in a way no one else did. This particular kind of grief challenges us to find meaning while acknowledging that some things truly are irreplaceable. What aspects of this loneliness feel most difficult for you?",
      
      "Your experience highlights what existentialists describe as the unique loneliness that comes from losing a spouse - it's not simply about being alone, but about losing that witness to your life, that person who knew you in ways no one else could. While this creates a void that cannot be filled in the same way, many find that acknowledging the unique and irreplaceable nature of that relationship is itself meaningful. How has this specific type of loneliness affected how you see yourself?",
      
      "What you're describing touches on a profound existential reality - that the intimacy built over decades with a spouse creates something singular that cannot simply be replaced. This recognition brings both pain and a honoring of how significant that relationship was. Viktor Frankl might suggest that even in this unique loneliness, we can find meaning through how we choose to carry that relationship forward with us. What aspects of your shared life continue to provide meaning for you now?",
      
      "The existential loneliness after losing a spouse is distinct from other forms of loneliness because it involves the loss of being deeply known by another person. This creates what philosophers call an 'ontological shift' - a fundamental change in how we experience our existence. Many find that while nothing can replace that particular relationship, acknowledging its uniqueness actually honors its significance. How has this experience changed your understanding of connection?",
      
      "Your description of loneliness after losing your spouse reflects what existential thinkers call the 'irreplaceability of the other' - the recognition that each relationship is unique and cannot simply be substituted. This creates a particular kind of grief, one that persists even when surrounded by caring others. Finding meaning doesn't require diminishing this reality, but rather acknowledging the profound impact this relationship had on who you are. What from that relationship continues to guide you today?"
    ];
    
    return spousalLossResponses[Math.floor(Math.random() * spousalLossResponses.length)];
  }
  
  // No clear existential concerns detected
  return null;
};

// Export the advanced logotherapeutic principles
export default {
  existentialPrinciples,
  existentialIndicators,
  generateExistentialResponse
};
